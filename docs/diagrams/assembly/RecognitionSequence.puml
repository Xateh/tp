@startuml
hide footbox
actor System
participant "BareCommand" as Cmd <<class>>
participant "CommandLexer" as LexerClass <<class>>
participant ":CommandLexer" as Lexer
participant "CommandParser" as ParserClass <<class>>
participant ":CommandParser" as Parser
participant ":CommandExtractor" as Extractor
participant ":BareCommandBuilder" as Builder

System -> Cmd: parse(commandString)
activate Cmd

' Lexing Phase
Cmd -> LexerClass: lexCommand(commandString)
activate LexerClass

create Lexer

LexerClass -> Lexer: new CommandLexer(commandString)

note right of Lexer
  Lexer processes the string
  character by character:
  - peek() to look ahead
  - advance() to consume
  - munch() to collect patterns
end note

LexerClass -> Lexer: lex()
activate Lexer

Lexer -> LexerClass: return tokenisedCommand
deactivate Lexer

LexerClass -> Cmd: return tokenisedCommand
deactivate LexerClass
destroy Lexer

' Parsing Phase
Cmd -> ParserClass: parseCommand(tokenisedCommand)
activate ParserClass

create Parser
ParserClass -> Parser: new CommandParser(tokenisedCommand)

note right of Parser
  Parser uses recursive descent,
  calling parsing methods that
  mirror the grammar structure
end note

ParserClass -> Parser: parseCommand()
activate Parser

Parser --> ParserClass: return astNodeCommand
deactivate Parser

ParserClass --> Cmd: return astNodeCommand
deactivate ParserClass
destroy Parser

' Extraction Phase
create Extractor
Cmd -> Extractor: new CommandExtractor()

Cmd -> Extractor: extract(astCommand)
activate Extractor

note right of Extractor
  Extractor uses the Visitor pattern
  to traverse the AST and build
  the final Command object
end note

create Builder
Extractor -> Builder: new BareCommandBuilder()

note right of Extractor
    multiple calls to
    BareCommandBuilder are made
    to set values while traversing
    the AST
end note

Extractor -> Builder: build()
activate Builder
create "BareCommand" as Result
Builder -> Result: new BareCommand(...)
Builder --> Extractor: return bareCommand
deactivate Builder

Extractor --> Cmd: return bareCommand
deactivate Extractor
destroy Builder

Cmd --> System: return bareCommand
deactivate Cmd
destroy Extractor

@enduml
